---
- rule: Unexpected UDP Traffic
  enabled: false
  override:
    enabled: replace

- rule: Launch Suspicious Network Tool in Container
  exceptions:
    - name: ignore_nc_in_dragonfly
      fields:
        - k8s.ns.name
        - container.image.repository
        - proc.exepath
        - proc.cmdline
      comps:
        - =
        - =
        - =
        - =
      values:
        - - databases
          - docker.dragonflydb.io/dragonflydb/dragonfly
          - /usr/bin/nc.openbsd
          - "nc -q1 localhost 9999"
  override:
    exceptions: append

- rule: Drop and execute new binary in container
  exceptions:
    - name: ignore_postfix_in_mailu
      fields:
        - k8s.ns.name
        - container.image.repository
        - proc.exepath
      comps:
        - =
        - =
        - =
      values:
        - - mailserver
          - ghcr.io/mailu/postfix
          - /usr/libexec/postfix/master
    - name: ignore_cni_binaries
      fields:
        - proc.exepath
      comps:
        - =
        - =
      values:
        - - /opt/cni/bin/multus
          - /opt/cni/bin/loopback
  override:
    exceptions: append

- rule: Contact K8S API Server From Container
  exceptions:
    - name: ignore_fluent_bit_api_access
      fields:
        - k8s.ns.name
        - container.image.repository
        - proc.exepath
      comps:
        - =
        - =
        - =
      values:
        - - observability
          - cr.fluentbit.io/fluent/fluent-bit
          - /fluent-bit/bin/fluent-bit
    - name: ignore_k8s_sidecar_api_access
      fields:
        - container.image.repository
        - proc.exepath
      comps:
        - =
        - =
      values:
        - - ghcr.io/home-operations/k8s-sidecar
          - /usr/local/bin/python3.13
    - name: ignore_authentik_api_access
      fields:
        - k8s.ns.name
        - container.image.repository
        - proc.exepath
      comps:
        - =
        - =
        - =
      values:
        - - security
          - ghcr.io/goauthentik/server
          - /usr/local/bin/python3.13
    - name: ignore_multus_cni_api_access
      fields:
        - proc.exepath
      comps:
        - =
      values:
        - - /opt/cni/bin/multus
  override:
    exceptions: append

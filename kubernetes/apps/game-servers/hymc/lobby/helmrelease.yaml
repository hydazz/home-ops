---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: hymc-lobby
spec:
  chartRef:
    kind: OCIRepository
    name: hymc-lobby
  interval: 1h
  values:
    image:
      repository: ghcr.io/itzg/minecraft-server
      tag: 2025.10.5@sha256:0062e45ec8aa8bdbeeb6b4ad0e15df804c4525f0e208b66d899ab677230ee0e9
    extraEnv:
      TZ: Australia/Melbourne
    minecraftServer:
      allowNether: false
      announcePlayerAchievements: false
      difficulty: peaceful
      eula: true
      forceGameMode: true
      gameMode: adventure
      generateStructures: false
      memory: 1G
      modrinth:
        projects:
          - worldedit
          - customnpcs
      onlineMode: false
      pluginUrls:
        - https://github.com/EssentialsX/Essentials/releases/download/2.21.2/EssentialsX-2.21.2.jar
        - https://github.com/EssentialsX/Essentials/releases/download/2.21.2/EssentialsXAntiBuild-2.21.2.jar
        - https://github.com/EssentialsX/Essentials/releases/download/2.21.2/EssentialsXChat-2.21.2.jar
        - https://github.com/EssentialsX/Essentials/releases/download/2.21.2/EssentialsXProtect-2.21.2.jar
        - https://github.com/EssentialsX/Essentials/releases/download/2.21.2/EssentialsXSpawn-2.21.2.jar
        - https://github.com/Multiverse/Multiverse-Core/releases/download/5.2.1/multiverse-core-5.2.1.jar
        - https://github.com/aerulion/VoidWorld/releases/download/v1.0.0/VoidWorld-1.0.0.jar
      pvp: false
      spawnAnimals: false
      spawnMonsters: false
      spawnNPCs: false
      spawnProtection: 0
      type: PAPER
      version: 1.21.8
    resources:
      requests:
        cpu: 50m
        memory: 1Gi
      limits:
        memory: 2Gi
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities: {drop: ["ALL"]}
    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
      fsGroupChangePolicy: OnRootMismatch
    persistence:
      dataDir:
        enabled: true
        existingClaim: hymc-lobby
